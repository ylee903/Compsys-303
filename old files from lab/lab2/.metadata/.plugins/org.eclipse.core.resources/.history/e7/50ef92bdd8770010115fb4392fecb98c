#include <system.h>
#include <altera_avalon_pio_regs.h>
#include <stdio.h>
#include "sccharts.h"
#include <stdbool.h>

int main() {
    // Create the struct for SCCharts
    TickData data;

    // Initialize the SCCharts model
    reset(&data);

    while (1) {
        // Fetch button inputs (remember that keys are active low)
        int buttonStatus = IORD_ALTERA_AVALON_PIO_DATA(KEYS_BASE);  // Read button values

        // Map the buttons to variables (assuming active-low logic)
        bool A = (buttonStatus & 0x1);  // Key 2
        bool B = (buttonStatus & 0x2);  // Key 1
        bool R = (buttonStatus & 0x4);  // Key 0

        // Pass the input values to SCCharts model
        data.A = !A;
        data.B = !B;
        data.R = !R;

        // Execute a tick (step the state machine forward)
        tick(&data);

        // Output O to Red LED (using a memory-mapped register to control LEDs)
        IOWR_ALTERA_AVALON_PIO_DATA(LED_RED_BASE, data.O);  // Assuming O is mapped to LEDs
    }

    return 0;
}
